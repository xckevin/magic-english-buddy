## 交互线框图说明
这是一套详细的交互线框图说明。这套方案将围绕“用户旅程（User Journey）”展开，分为五个核心场景。

---

### 场景一：魔法起源（初始化与角色选择）

**交互逻辑**：首次打开应用，通过简单的故事引导建立情感连接。

---

* **线框图元素**：
1. **全屏背景**：手绘风格的乌云密布的地图，中心有一颗发光的蛋。
2. **对话框**：底部弹出，文字带打字机效果：“Oh! A lost magic egg. Use your voice to wake it up.”
3. **交互按钮**：中心一个巨大的圆形麦克风图标。


* **交互步骤**：
1. **Step 1**：用户长按麦克风说出任意英语（或只是发声）。
2. **Step 2**：屏幕出现震动反馈（Vibrate API），蛋壳裂开，爆发出果冻特效。
3. **Step 3**：弹出起名输入框，键盘升起，用户为 Buddy 命名。


* **设计细节**：禁止使用生硬的“Next”按钮，所有的推进都通过点击画面中的魔法元素完成。

---

### 场景二：迷雾地图（主交互界面）

**交互逻辑**：将传统的分级列表转化为可探索的线性路径。

---

* **线框图元素**：
1. **顶部状态栏**：左侧显示 Buddy 头像（带心情槽），右侧显示魔力值（MP）和等级。
2. **滚动地图**：长条形地图。已解锁区域为彩色，未解锁区域覆盖灰色半透明层（迷雾）。
3. **节点（Nodes）**：每一个故事是一个发光的五角星或小房子。
4. **当前目标**：当前最前沿的节点会有一个循环缩放的“光圈”提示。


* **交互步骤**：
1. **Step 1**：用户手指左右滑动查看地图全貌。
2. **Step 2**：点击当前光圈节点，弹出预览弹窗（显示故事标题、难度星级、预计奖励）。
3. **Step 3**：点击“Enter Adventure”进入阅读模式。



---

### 场景三：魔法镜阅读器（沉浸式输入）

**交互逻辑**：解决“看、听、说”的深度结合。

---

* **线框图元素**：
1. **左侧/顶部**：故事插图占 1/3 屏幕。
2. **主体区**：大字号、高行间距的英语文本。
3. **控制条**：底部包含 [播放/暂停]、[语速控制 0.8x/1.0x]、[查词开关]。
4. **悬浮 Buddy**：屏幕右下角有个小的 Buddy 动画，它会随着朗读进度跳动。


* **交互步骤**：
1. **Step 1 (Follow-the-light)**：点击播放，当前朗读单词背景变黄，其他单词颜色变淡。
2. **Step 2 (Shadowing)**：点击每行末尾的“小耳朵”图标，进入影子跟读模式。系统播放该句，然后弹出麦克风，录制用户声音。
3. **Step 3 (Tap-to-Search)**：长按单词，Buddy 立即跳到单词上方，头顶冒出气泡显示中文和 Emoji。


* **设计细节**：点击翻页时，模拟纸张翻动音效，增加物理感。

---

### 场景四：魔法挑战（Quiz 练习）

**交互逻辑**：去考试化，将其包装为“收集魔力”的过程。

---

* **线框图元素**：
1. **进度条**：顶部显示本关 3-5 个魔法球，答对一个亮起一个。
2. **题目区**：例如“碎纸机还原”——中间是打乱的单词方块。
3. **操作区**：底部是空白的虚线框。


* **交互步骤**：
1. **Step 1**：用户拖拽单词方块到虚线框。
2. **Step 2**：若顺序正确，单词方块变绿并发出“Ding”声；若错误，方块像橡皮筋一样弹回原位。
3. **Step 3**：所有题目完成，弹出全屏动画：Buddy 吸收魔力值，等级进度条猛增。



---

### 场景五：守护者卷轴（进度同步）

**交互逻辑**：解决离线环境下老师/家长对学习进度掌握的需求。

---

* **线框图元素**：
1. **个人名片**：孩子与 Buddy 的合影，左侧标注“L3 守护者”。
2. **核心数据**：用简单图标表示，如 [书本图标: 24本]、[时钟图标: 300分钟]、[奖杯图标: 15个]。
3. **动态二维码**：占据屏幕 40% 的面积，下方标注“请让老师扫描以同步魔法数据”。


* **交互步骤**：
1. **Step 1**：用户点击主界面右上角的“Scroll”图标进入。
2. **Step 2**：数据自动封装成二维码。
3. **Step 3**：点击下方的“Print”按钮，可以将此页面保存为带底纹的精美图片到本地相册。



---

### 给开发者的技术实现思考 (Thinking Constituent)

1. **状态驱动 (State Management)**：
* 整个 UI 是一个巨大的状态机。例如：`Status: Reading -> Quiz -> Reward`。
* 建议使用 **XState** 库来管理这些复杂的交互流，确保在断网切换时状态不丢失。


2. **性能限定 (Performance Constraints)**：
* **资源预加载**：进入地图时，异步预加载当前节点前后 2 个节点的 JSON 和插图。
* **动画优化**：Buddy 的动画建议使用 **Lottie (JSON)** 格式，既能保持极高清晰度，体积又远小于 GIF，适合偏远地区设备。


3. **最后自检逻辑 (Final Check)**：
* **断电测试**：如果在 Quiz 过程中突然关机，重启后是否能回到该题？（需实时写入 `localStorage`）。
* **离线闭环**：在完全关闭 Wi-Fi 的情况下，从“点击地图”到“生成二维码”是否能无感完成？（需确保所有 Service Worker 缓存策略生效）。



## ASCII 线框图
为了确保技术实现能够精准还原设计，我将《Magic English Buddy》的五个核心场景转化为详细的 **ASCII 线框图**。每一张图都标注了交互组件、布局尺寸感以及对应的技术实现逻辑。

---

### 1. 场景一：魔法起源 (Initial Onboarding)

**设计目标**：通过触觉和视觉反馈，建立用户与虚拟伙伴的“第一契约”。

```text
+-------------------------------------------------------+
| [Status Bar: Battery, Time, Offline Icon]             |
+-------------------------------------------------------+
|                                                       |
|          ( ( (  [ Floating Mist ]  ) ) )              |
|                                                       |
|                 /-----------\                         |
|                /      ?      \   <-- Magic Egg        |
|               |       * |      (Glow Effect)    |
|                \     / \     /                        |
|                 \-----------/                         |
|                                                       |
|                                                       |
|    "Tap and hold the magic orb to wake your Buddy"    |
|                                                       |
|                    /@@@@@\                            |
|                   |  MIC  |  <-- Long Press Trigger   |
|                    \@@@@@/                            |
|                                                       |
+-------------------------------------------------------+

```

* **交互细节**：
* **长按麦克风**：触发 `navigator.vibrate([100, 50, 100])` 震动反馈。
* **蛋壳破碎动画**：SVG路径动画，蛋壳向四周飞散。
* **逻辑**：检测到音频输入（无论质量）即视为成功，降低挫败感。



---

### 2. 场景二：迷雾地图 (Main Map Navigation)

**设计目标**：游戏化路径，明确“已学、当前、待学”的状态。

```text
+-------------------------------------------------------+
| [ Buddy Icon ]  MP: 1250 [#####---]  Lvl: 2 [ Setting ]|
+-------------------------------------------------------+
|                                                       |
|    [?] <--- Hidden Node (Foggy)                       |
|     |                                                 |
|     |                                                 |
|    [*] <--- Next Adventure (Pulsing Light)            |
|     |       "The Green Forest"                        |
|     |                                                 |
|    [V] <--- Completed (Golden Star)                   |
|     |                                                 |
|    [O] <--- Start Point                               |
|                                                       |
+-------------------------------------------------------+
| [ Map ]    [ Spell Book ]    [ Buddy ]    [ Scroll ]  |
+-------------------------------------------------------+

```

* **交互细节**：
* **Pulsing Light**：当前节点使用 CSS `animation: pulse 2s infinite`。
* **迷雾效果**：未解锁区域使用 `backdrop-filter: blur(5px) grayscale(100%)`。
* **点击节点**：弹出 Modal，显示故事简介和掉落物品。



---

### 场景三：魔法镜阅读器 (Reader Interface)

**设计目标**：极致的沉浸式输入，弱化查词阻力。

```text
+-------------------------------------------------------+
| [ Back ]      Story: The Little Rabbit      [ Speed ] |
+-------------------------------------------------------+
|  +-------------------------------------------------+  |
|  |                [ Illustration ]                 |  |
|  |             Rabbit eating a carrot              |  |
|  +-------------------------------------------------+  |
|                                                       |
|  Once there [was] a little rabbit.  <-- [was] Highlit |
|  He lived in a [green] forest.                        |
|                                                       |
|  [ Play/Pause ]   [ Echo Mode ]   [ Word Magic: ON ]  |
+-------------------------------------------------------+
|      (Buddy Character)  "Listen to the rhythm!"       |
+-------------------------------------------------------+

```

* **交互细节**：
* **高亮同步**：TTS 触发 `onBoundary` 事件时，更新当前单词的 `className="active-word"`。
* **Echo 模式**：点击后，系统播一句，自动切换到录音状态。
* **悬浮 Buddy**：Buddy 会根据阅读的情绪（基于 JSON 配置）变换表情。



---

### 场景四：魔法挑战 (Quiz / Task)

**设计目标**：即时反馈，利用拖拽增强记忆。

```text
+-------------------------------------------------------+
|  Progress: [X] [X] [ ] [ ] [ ]      ( 2 / 5 )         |
+-------------------------------------------------------+
|                                                       |
|       "Translate the sentence into order"             |
|                                                       |
|       [ Rabbit ]  [ Forest ]  [ The ]  [ In ]         |
|                                                       |
|  +-------------------------------------------------+  |
|  |  [ The ] [ Rabbit ] [____] [____]               |  |
|  +-------------------------------------------------+  |
|                                                       |
|  [ Check Answer ]               [ Get a Hint (-5 MP) ]|
+-------------------------------------------------------+

```

* **交互细节**：
* **拖拽库**：建议使用 `dnd-kit` 或 `sortablejs`，支持触摸屏。
* **错误反馈**：若顺序错误，目标框红色闪烁，方块平滑回弹到待选区。
* **正确反馈**：撒花特效（Canvas Confetti）。



---

### 场景五：守护者卷轴 (Progress Sync & Reward)

**设计目标**：离线环境下的成果可视化与物理连接。

```text
+-------------------------------------------------------+
|                GUARDIAN'S SCROLL                      |
|  +-------------------------------------------------+  |
|  |  [ Kid's Avatar ]          [ Buddy Level 3 ]    |  |
|  |  Name: Sparky              Status: Master       |  |
|  +-------------------------------------------------+  |
|                                                       |
|    Reading: 42 stories      Words: 520 cards          |
|                                                       |
|    +---------------------------------------------+    |
|    |      [ SCAN THIS TO SYNC PROGRESS ]         |    |
|    |                [ QR CODE ]                  |    |
|    |              (Teacher/Parent)               |    |
|    +---------------------------------------------+    |
+-------------------------------------------------------+
| [  Save Image  ]              [  Print Certificate  ] |
+-------------------------------------------------------+

```

* **交互细节**：
* **QR 生成**：使用 `qrcode.js` 在本地将 `Stringify({uid, lvl, words, timestamp})` 转为二维码。
* **离线保存**：利用 `html2canvas` 将整个卷轴区域渲染为 PNG，保存至手机相册，方便打印或传播。



---

### 开发实现的自检逻辑 (Checklist)

1. **数据持久化**：
* [ ] 每次 Quiz 完成后，`db.userProgress.put()` 确保数据存入 IndexedDB。


2. **视觉还原度**：
* [ ] 线框图中的所有 Padding 是否保持一致（推荐 16px/24px）。
* [ ] Buddy 动画在低端安卓机上是否掉帧（建议关闭阴影和高斯模糊）。


3. **异常处理**：
* [ ] 如果 TTS 离线包未下载，是否有优雅的降级文字提示？
* [ ] 二维码数据量是否过大？（建议对生词 ID 列表进行 Base64 压缩）。



这套线框图为您提供了从“交互动作”到“技术接口”的直接对应关系，便于 UI/UX 设计师进行视觉打磨，也便于前端工程师直接搭建组件树。